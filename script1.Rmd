---
title: "Covid Cases in R"
output:
  html_document:
    df_print: paged
---
# Covid-19 Kaynaklı En Fazla Ölümün Olduğu 25 Ülke

```{r include=FALSE}

library(httr)
library(readxl)
library(RCurl) #Bir link çalışmazsa diğer linki çalıştıracak bir kod var burada.

# http://memosisland.blogspot.com/2012/03/check-url-existance-with-r.html

url2 <- paste("https://opendata.ecdc.europa.eu/covid19/casedistribution/csv")
GET(url2, write_disk(tf<-tempfile(fileext = ".csv")))

df=read.csv((tf))
```


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
covid_death_total <- sum(df$deaths)
covid_cases_total <- sum(df$cases)

covid_death <- aggregate(df$deaths, by=list(countriesAndTerritories=df$countryterritoryCode), FUN=sum)
covid_death_tr <- covid_death[186,2]

covid_cases <- aggregate(df$cases, by=list(countriesAndTerritories=df$countryterritoryCode), FUN=sum)
covid_cases_tr <- covid_cases[186,2]

covid_death_top <- aggregate(x = df$deaths,
          by = list(df$countriesAndTerritories),              
          FUN = sum) 

covid_death_top_25 <- covid_death_top[order(-covid_death_top$x),]

head(covid_death_top_25,n=25)

```
Dünya genelinde `r Sys.Date()` tarihine kadar Covid-19 tespit edilen vaka sayısı `r covid_cases_total` olmuştur. .

Dünya genelinde `r Sys.Date()` tarihine kadar Covid-19'dan ölen toplam kişi sayısı `r covid_death_total` olmuştur. 

Türkiye genelinde `r Sys.Date()` tarihine kadar Covid-19 tespit edilen vaka sayısı `r covid_cases_tr` olmuştur. 

Türkiye genelinde `r Sys.Date()` tarihine kadar Covid-19'dan ölen toplam kişi sayısı `r covid_death_tr` olmuştur. 

<!-- The features we have are: `r names(df)`. -->

# Türkiye İstatistikleri

```{r include=FALSE}
library(Hmisc)

# https://www.kaggle.com/gkhan496/covid19-in-turkey#covid_19_data_tr.csv

data <- read.csv("C:/Users/SATELLITE/Desktop/Covid_R/covid_19_data_tr.csv", stringsAsFactors = FALSE)

describe(data)
```

```{r include=FALSE}

library(lubridate)
data$Last_Update <- mdy(data$Last_Update)

# alternative
# data <- data %>%
# mutate(days = dmy(Last_Update))

```

#Türkiye için Hasta / İyileşen Sayısı

```{r echo=FALSE}
library(directlabels)

base <- ggplot(data = data, aes(x=Last_Update, 
                                y=Toplam_Kişi_Sayısı,group=1)) +
  geom_line(aes(y = Deaths), color="black",size=0.8, linetype="dashed") + 
  geom_line(aes(y = Recovered), color="steelblue",size=0.8, linetype = "twodash") +
geom_text(aes(x = as.Date("2020-04-12"), y = 7089, label = "Toplam İyileşen", color = "Recovered")) + 
geom_text(aes(x = as.Date("2020-04-12"), y = 1518, label = "Toplam Ölüm", color = "Deaths"))
  
  base + scale_x_date(date_breaks = "4 days", date_labels = "%b %d")  
    
```

```{r echo=FALSE, message=FALSE}
library(dplyr)
library(DT)
edf <- df %>% group_by(countriesAndTerritories) %>% mutate(deathRate = sum(deaths)/sum(cases))

datatable(
edf[,c(1,5,6,7,11)], extensions = 'Buttons', options = list(
dom = 'Bfrtip',
buttons = c('copy', 'csv', 'excel', 'pdf', 'print')
)
)

```

# Grafikler {.tabset}

## Grafik A 

```{r echo=FALSE}
library(ggplot2)

edf %>% filter(deaths > 50) %>%
group_by(countriesAndTerritories) %>%
summarise(Toplam_Olum = sum(deaths)) %>%
ggplot(aes(countriesAndTerritories)) +
geom_point(aes(y = Toplam_Olum, color = "red", size = Toplam_Olum)) +
coord_flip()
```

## Grafik B 

```{r echo=FALSE}
library(scales) # to access break formatting functions

edf %>% filter(cases > 1000) %>%
group_by(countriesAndTerritories) %>%
summarise(Toplam_Vaka = log2(sum(cases))) %>%

ggplot(aes(countriesAndTerritories)) +
geom_point(aes(y = Toplam_Vaka, color = "red", size = Toplam_Vaka)) +
coord_flip() 
```

```{r}
# library(kableExtra)
# library(tidyverse)
# library(zoo)
# library(ggplot2)
# library(devtools)
# 
# url3 <- paste("https://opendata.ecdc.europa.eu/covid19/casedistribution/csv")
# GET(url3, write_disk(tff<-tempfile(fileext = ".csv")))
# 
# dff=read.csv((tf))
# 
# veriseti <- head(dff)
# kable(veriseti) %>%
#   kable_styling(bootstrap_options = "striped", font_size = 10, full_width = F)



```

